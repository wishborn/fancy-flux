# D3 Component

Advanced data visualization component powered by D3.js. Provides visualizations that complement Flux Pro's chart component.

> **Note:** This component focuses on advanced visualizations (force graphs, hierarchies, flow diagrams) that Flux Pro doesn't offer. For basic line/area/bar charts, use `flux:chart` from Flux Pro.

## Why This Component?

The D3 component brings powerful visualization capabilities to FancyFlux:
- Force-directed graphs for network relationships
- Hierarchical layouts (tree, treemap, sunburst, pack)
- Flow diagrams (sankey, chord)
- Sparklines for inline table visualizations

## Installation

The D3 component is included with Fancy Flux. D3.js is loaded from CDN by default.

```blade
<flux:d3 type="force" :data="$networkData" />
```

## Basic Usage

### Force-Directed Graph

Display network relationships and connections:

```blade
@php
$networkData = [
    'nodes' => [
        ['id' => 'A', 'label' => 'Node A', 'group' => 1],
        ['id' => 'B', 'label' => 'Node B', 'group' => 1],
        ['id' => 'C', 'label' => 'Node C', 'group' => 2],
    ],
    'links' => [
        ['source' => 'A', 'target' => 'B', 'value' => 1],
        ['source' => 'B', 'target' => 'C', 'value' => 2],
    ],
];
@endphp

<flux:d3 type="force" :data="$networkData" :height="500" tooltip zoom />
```

### Tree Diagram

Display hierarchical data as a tree:

```blade
@php
$orgChart = [
    'name' => 'CEO',
    'children' => [
        [
            'name' => 'CTO',
            'children' => [
                ['name' => 'Dev Lead'],
                ['name' => 'QA Lead'],
            ],
        ],
        [
            'name' => 'CFO',
            'children' => [
                ['name' => 'Accounting'],
            ],
        ],
    ],
];
@endphp

<flux:d3 type="tree" :data="$orgChart" :height="400" />
```

### Treemap

Display hierarchical data as nested rectangles:

```blade
@php
$fileSystem = [
    'name' => 'root',
    'children' => [
        ['name' => 'src', 'value' => 1000],
        ['name' => 'tests', 'value' => 500],
        ['name' => 'docs', 'value' => 200],
    ],
];
@endphp

<flux:d3 type="treemap" :data="$fileSystem" :height="300" tooltip />
```

### Sunburst

Display hierarchical proportions in a radial layout:

```blade
<flux:d3 type="sunburst" :data="$categoryBreakdown" :height="400" tooltip />
```

### Circle Packing

Display hierarchical data as nested circles:

```blade
<flux:d3 type="pack" :data="$hierarchy" :height="400" />
```

### Chord Diagram

Display flow between groups using a matrix:

```blade
@php
// Matrix representing flow between 4 groups
$flowMatrix = [
    [11975, 5871, 8916, 2868],
    [1951, 10048, 2060, 6171],
    [8010, 16145, 8090, 8045],
    [1013, 990, 940, 6907],
];
@endphp

<flux:d3 type="chord" :data="$flowMatrix" :height="500" tooltip />
```

## Sparklines

Compact inline visualizations perfect for table cells:

```blade
{{-- Line sparkline --}}
<flux:d3.sparkline :data="[1, 5, 3, 8, 2, 7]" />

{{-- Area sparkline --}}
<flux:d3.sparkline :data="$trend" type="area" color="emerald" />

{{-- Bar sparkline --}}
<flux:d3.sparkline :data="$distribution" type="bar" class="w-20 h-6" />

{{-- Win/loss sparkline --}}
<flux:d3.sparkline :data="[1, -1, 1, 1, -1, 1]" type="win-loss" />
```

### Sparkline in Table Cells

```blade
<flux:fancy-table :columns="$columns" :rows="$users">
    <flux:fancy-table.body :rows="$users">
        <flux:fancy-table.row :row="$row">
            <flux:fancy-table.cell>{{ $row->name }}</flux:fancy-table.cell>
            <flux:fancy-table.cell>
                <flux:d3.sparkline :data="$row->activity_trend" color="blue" />
            </flux:fancy-table.cell>
        </flux:fancy-table.row>
    </flux:fancy-table.body>
</flux:fancy-table>
```

## D3 in Table Trays

Embed D3 visualizations in expandable table rows:

```blade
@php
$rows = [
    [
        'id' => 1,
        'name' => 'Project A',
        'tray' => [
            '_d3' => [
                'type' => 'tree',
                'data' => $projectAHierarchy,
                'height' => 300,
            ],
        ],
    ],
];
@endphp

<flux:fancy-table :columns="$columns" :rows="$rows" />
```

## Programmatic Control

Use the FANCY facade to control D3 visualizations:

```php
use FancyFlux\Facades\FANCY;

// Update data
FANCY::d3('network-graph')->update($newData);

// Refresh visualization
FANCY::d3('org-chart')->refresh();

// Reset to initial state
FANCY::d3('my-viz')->reset();

// Zoom controls
FANCY::d3('network')->zoomToFit();
FANCY::d3('network')->zoomTo('node-5');

// Highlight nodes
FANCY::d3('graph')->highlight(['A', 'B', 'C']);
FANCY::d3('graph')->clearHighlight();

// Hierarchical controls
FANCY::d3('tree')->toggleNode('node-3');
FANCY::d3('tree')->expandAll();
FANCY::d3('tree')->collapseAll();
```

### Using the Trait

```php
use FancyFlux\Concerns\InteractsWithD3;

class Dashboard extends Component
{
    use InteractsWithD3;
    
    public function refreshGraph(): void
    {
        $this->d3('network-graph')->update($this->getNetworkData());
    }
}
```

## Customization

### Colors

```blade
{{-- Use Tailwind color names --}}
<flux:d3.sparkline :data="$data" color="emerald" />

{{-- Custom color arrays --}}
<flux:d3 
    type="force" 
    :data="$data"
    :colors="['#4e79a7', '#f28e2c', '#e15759']"
    :dark-colors="['#6fa8dc', '#f6b26b', '#e06666']"
/>
```

### Dark Mode

Dark mode is automatic. The component uses `dark-colors` when the `dark` class is present on `<html>`.

### Animation

```blade
{{-- Disable animation --}}
<flux:d3 type="force" :data="$data" :animate="false" />

{{-- Custom duration --}}
<flux:d3 type="tree" :data="$data" :duration="1000" />

{{-- Animated sparkline --}}
<flux:d3.sparkline :data="$data" animate />
```

### Tooltips

```blade
<flux:d3 type="force" :data="$data" tooltip />
```

### Zoom & Pan

```blade
<flux:d3 type="force" :data="$data" zoom />
```

## Props Reference

### flux:d3

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `name` | string | auto | Unique ID for programmatic control |
| `type` | string | required | Visualization type: force, tree, treemap, sunburst, pack, chord |
| `data` | array | `[]` | Visualization data |
| `width` | int | null | Width (responsive by default) |
| `height` | int | 400 | Height in pixels |
| `margin` | array | [20,20,30,40] | Margins [top,right,bottom,left] |
| `colors` | array | config | Color palette |
| `dark-colors` | array | config | Dark mode colors |
| `animate` | bool | true | Enable animations |
| `duration` | int | 500 | Animation duration (ms) |
| `responsive` | bool | true | Responsive sizing |
| `tooltip` | bool | false | Enable tooltips |
| `zoom` | bool | false | Enable zoom/pan |

### flux:d3.sparkline

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `data` | array | `[]` | Numeric data array |
| `type` | string | 'line' | Type: line, area, bar, win-loss |
| `color` | string | 'blue' | Tailwind color name or hex |
| `dark-color` | string | null | Dark mode color override |
| `width` | int | 80 | Width in pixels |
| `height` | int | 24 | Height in pixels |
| `stroke-width` | float | 1.5 | Line stroke width |
| `fill` | bool | false | Fill under line |
| `show-endpoint` | bool | false | Show endpoint marker |
| `show-min-max` | bool | false | Show min/max markers |
| `animate` | bool | false | Animate on load |

## Data Formats

### Force Graph

```php
$data = [
    'nodes' => [
        ['id' => 'A', 'label' => 'Node A', 'group' => 1, 'radius' => 10],
        ['id' => 'B', 'label' => 'Node B', 'group' => 2],
    ],
    'links' => [
        ['source' => 'A', 'target' => 'B', 'value' => 1],
    ],
];
```

### Hierarchy (tree, treemap, sunburst, pack)

```php
$data = [
    'name' => 'root',
    'children' => [
        ['name' => 'child1', 'value' => 100],
        [
            'name' => 'child2',
            'children' => [
                ['name' => 'grandchild', 'value' => 50],
            ],
        ],
    ],
];
```

### Chord (matrix)

```php
// NxN matrix where data[i][j] represents flow from i to j
$data = [
    [100, 50, 30],
    [20, 80, 10],
    [40, 15, 60],
];
```

## Configuration

Configure D3 options in `config/fancy-flux.php`:

```php
'd3' => [
    'source' => 'cdn', // 'cdn' or 'local'
    'cdn_url' => 'https://cdn.jsdelivr.net/npm/d3@7',
    'local_path' => '/vendor/fancy-flux/d3.min.js',
    'animation_duration' => 500,
    'colors' => ['#4e79a7', '#f28e2c', ...],
    'dark_colors' => ['#6fa8dc', '#f6b26b', ...],
],
```

## Examples

### Network Visualization

```blade
<flux:card>
    <flux:heading>Team Connections</flux:heading>
    <flux:d3 
        name="team-network"
        type="force" 
        :data="$teamConnections" 
        :height="500"
        tooltip
        zoom
    >
        <flux:d3.legend :items="$groups" position="top-right" />
    </flux:d3>
</flux:card>
```

### Organization Chart

```blade
<flux:d3 
    type="tree" 
    :data="$orgChart" 
    :height="600"
    :margin="['top' => 20, 'right' => 120, 'bottom' => 20, 'left' => 120]"
/>
```

### Dashboard with Sparklines

```blade
<flux:fancy-table :columns="$columns">
    <flux:fancy-table.body :rows="$metrics">
        <flux:fancy-table.row :row="$row">
            <flux:fancy-table.cell>{{ $row->name }}</flux:fancy-table.cell>
            <flux:fancy-table.cell>
                <flux:d3.sparkline 
                    :data="$row->values" 
                    :color="$row->trend > 0 ? 'emerald' : 'red'"
                    show-endpoint
                />
            </flux:fancy-table.cell>
            <flux:fancy-table.cell>
                {{ number_format($row->current) }}
            </flux:fancy-table.cell>
        </flux:fancy-table.row>
    </flux:fancy-table.body>
</flux:fancy-table>
```
